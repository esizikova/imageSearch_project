% clear the workspace
close all;
clear all;

% Choose what visualization you want
confMatrix = 1;
2DEmbedding = 1;

% Add subfolders to search path
addpath([ pwd,'/Descriptors'] );

% Load the images
[images, labels] = loadImages( '../gistDataset/', 5 );
noOfDatapoints = size(images,2);

% Create the map of function handles 
functionMap = createFunctionHandleMap();

% get the handles to descriptors here
f1 = functionMap ( 'singularValues' );
f2 = functionMap ( 'statisticsLab' );
fHandles = { f1, f2 };

% compute descriptors for single image to get the total length
descriptorLength = 0;
for i = 1:length(fHandles)
    fHandle = fHandles{i};
    curLength = size( fHandle (images{1} ), 1 );
    descriptorLength = descriptorLength + curLength;
end;

% Compute the descriptors for each image, and store them
% prepare the pairwise distance 
tic
descriptors = zeros( noOfDatapoints, descriptorLength ); 
for i = 1:noOfDatapoints
    fullDescriptor = [];
    for j = 1:length(fHandles)
        fHandle = fHandles{j};
        curDescriptor = fHandle ( images{i} );
        fullDescriptor = [fullDescriptor ; curDescriptor];
    end;
    descriptors( i, : ) = fullDescriptor;
end
toc;

dVec = pdist( descriptors, 'euclidean');
D = squareform(dVec);

if ( confMatrix )
    plotMatrix(D,labels);
end;

if ( 2DEmbedding ) 
    [embedding2D,eigvals] = cmdscale(D);
end;

